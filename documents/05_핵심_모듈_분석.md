# 05. Sensor Game Hub - í•µì‹¬ ëª¨ë“ˆ ë¶„ì„

> **ì‘ì„±ì¼**: 2025-01-10
> **ë²„ì „**: v6.1.0
> **ëª©ì **: ì£¼ìš” ì‹œìŠ¤í…œ ëª¨ë“ˆ ì™„ì „ ë¶„ì„

---

## ğŸ“‹ ëª©ì°¨

1. [ëª¨ë“ˆ ê°œìš”](#1-ëª¨ë“ˆ-ê°œìš”)
2. [SessionManager](#2-sessionmanager)
3. [GameScanner](#3-gamescanner)
4. [GameValidator](#4-gamevalidator)
5. [SessionSDK](#5-sessionsdk)
6. [ëª¨ë“ˆ ê°„ ìƒí˜¸ì‘ìš©](#6-ëª¨ë“ˆ-ê°„-ìƒí˜¸ì‘ìš©)

---

## 1. ëª¨ë“ˆ ê°œìš”

### 1.1 í•µì‹¬ ëª¨ë“ˆ ëª©ë¡

| ëª¨ë“ˆ | ë¼ì¸ ìˆ˜ | ì—­í•  | ë³µì¡ë„ |
|------|---------|------|--------|
| **SessionManager** | 363 | ê²Œì„-ì„¼ì„œ ê°„ ì„¸ì…˜ ê´€ë¦¬ | â­â­â­ |
| **GameScanner** | 435 | ê²Œì„ íŒŒì¼ ìŠ¤ìº” ë° ë™ê¸°í™” | â­â­â­ |
| **GameValidator** | 972 | ì½”ë“œ í’ˆì§ˆ ê²€ì¦ | â­â­â­â­ |
| **SessionSDK** | 590 | í´ë¼ì´ì–¸íŠ¸ í†µí•© SDK | â­â­â­â­ |

### 1.2 ëª¨ë“ˆ ì˜ì¡´ì„± ê·¸ë˜í”„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ëª¨ë“ˆ ì˜ì¡´ì„± ê´€ê³„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

server/index.js (ë©”ì¸ ì„œë²„)
    â”œâ”€â”€â”€ SessionManager
    â”œâ”€â”€â”€ GameScanner
    â”œâ”€â”€â”€ InteractiveGameGenerator
    â”‚       â”œâ”€â”€â”€ GameValidator
    â”‚       â”œâ”€â”€â”€ GameGenreClassifier
    â”‚       â””â”€â”€â”€ DocumentEmbedder
    â””â”€â”€â”€ GameMaintenanceManager
            â””â”€â”€â”€ GameValidator

public/js/SessionSDK.js (í´ë¼ì´ì–¸íŠ¸)
    â”œâ”€â”€â”€ QRCodeGenerator
    â””â”€â”€â”€ SensorCollector
```

---

## 2. SessionManager

### 2.1 í´ë˜ìŠ¤ êµ¬ì¡°

```javascript
// server/SessionManager.js (363ì¤„)
class SessionManager {
    constructor() {
        // í™œì„± ì„¸ì…˜ ì €ì¥ì†Œ
        this.sessions = new Map();  // sessionId â†’ sessionData

        // 4ìë¦¬ ì„¸ì…˜ ì½”ë“œ ë§¤í•‘
        this.sessionCodes = new Map();  // sessionCode â†’ sessionId

        // ì •ë¦¬ íƒ€ì´ë¨¸
        this.cleanupInterval = null;

        // í†µê³„
        this.stats = {
            totalSessions: 0,
            activeSessions: 0,
            peakSessions: 0,
            totalSensorConnections: 0
        };
    }
}
```

### 2.2 ì£¼ìš” ë©”ì„œë“œ

#### 2.2.1 ì„¸ì…˜ ìƒì„±

```javascript
createSession(gameId, gameType, hostSocketId) {
    const sessionId = this.generateSessionId();  // UUID
    const sessionCode = this.generateSessionCode();  // 4ìë¦¬ (1000-9999)

    const session = {
        id: sessionId,
        code: sessionCode,
        gameId: gameId,
        gameType: gameType,
        host: hostSocketId,
        sensors: new Map(),  // sensorId â†’ sensorData
        status: 'waiting',   // waiting, ready, playing, ended
        createdAt: Date.now(),
        lastActivity: Date.now(),
        maxSensors: this.getMaxSensors(gameType)
    };

    this.sessions.set(sessionId, session);
    this.sessionCodes.set(sessionCode, sessionId);

    // í†µê³„ ì—…ë°ì´íŠ¸
    this.stats.totalSessions++;
    this.stats.activeSessions++;
    if (this.stats.activeSessions > this.stats.peakSessions) {
        this.stats.peakSessions = this.stats.activeSessions;
    }

    console.log(`âœ… ì„¸ì…˜ ìƒì„±: ${sessionId} (ì½”ë“œ: ${sessionCode})`);

    return session;
}

// ìµœëŒ€ ì„¼ì„œ ê°œìˆ˜
getMaxSensors(gameType) {
    switch (gameType) {
        case 'solo': return 1;
        case 'dual': return 2;
        case 'multi': return 10;
        default: return 1;
    }
}
```

#### 2.2.2 ì„¼ì„œ ì—°ê²°

```javascript
connectSensor(sessionCode, sensorSocketId, deviceInfo) {
    // 1. ì„¸ì…˜ ì¡°íšŒ
    const sessionId = this.sessionCodes.get(sessionCode);
    if (!sessionId) {
        throw new Error(`ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${sessionCode}`);
    }

    const session = this.sessions.get(sessionId);
    if (!session) {
        throw new Error('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // 2. ìµœëŒ€ ì„¼ì„œ ê°œìˆ˜ í™•ì¸
    if (session.sensors.size >= session.maxSensors) {
        throw new Error(`ì„¼ì„œê°€ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤ (ìµœëŒ€: ${session.maxSensors})`);
    }

    // 3. ì„¼ì„œ ID ìƒì„±
    const sensorId = `sensor${session.sensors.size + 1}`;

    // 4. ì„¼ì„œ ë°ì´í„° ì €ì¥
    session.sensors.set(sensorId, {
        id: sensorId,
        socketId: sensorSocketId,
        deviceInfo: deviceInfo,
        connectedAt: Date.now(),
        lastDataTime: Date.now(),
        dataCount: 0
    });

    // 5. ìƒíƒœ ì—…ë°ì´íŠ¸
    session.lastActivity = Date.now();

    // ìë™ ì¤€ë¹„ ìƒíƒœ ì „í™˜
    if (session.sensors.size === session.maxSensors) {
        session.status = 'ready';
        console.log(`ğŸ® ì„¸ì…˜ ì¤€ë¹„ ì™„ë£Œ: ${sessionId}`);
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    this.stats.totalSensorConnections++;

    console.log(`ğŸ“± ì„¼ì„œ ì—°ê²°: ${sensorId} â†’ ì„¸ì…˜ ${sessionId}`);

    return { sessionId, sensorId };
}
```

#### 2.2.3 ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸

```javascript
updateSensorData(sessionCode, sensorId, sensorData) {
    const session = this.getSessionByCode(sessionCode);
    if (!session) {
        throw new Error('ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }

    const sensor = session.sensors.get(sensorId);
    if (!sensor) {
        throw new Error('ì„¼ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }

    // ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸
    sensor.lastDataTime = Date.now();
    sensor.dataCount++;

    // ì„¸ì…˜ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
    session.lastActivity = Date.now();

    return { updated: true };
}
```

#### 2.2.4 4ìë¦¬ ì„¸ì…˜ ì½”ë“œ ìƒì„±

```javascript
generateSessionCode() {
    let code;
    let attempts = 0;
    const maxAttempts = 100;

    do {
        // 1000-9999 ë²”ìœ„ (4ìë¦¬)
        code = Math.floor(1000 + Math.random() * 9000).toString();
        attempts++;

        if (attempts > maxAttempts) {
            throw new Error('ì„¸ì…˜ ì½”ë“œ ìƒì„± ì‹¤íŒ¨ (ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼)');
        }
    } while (this.sessionCodes.has(code));  // ì¤‘ë³µ í™•ì¸

    return code;
}
```

**ì½”ë“œ ë²”ìœ„**:
- ìµœì†Œ: 1000
- ìµœëŒ€: 9999
- ì´ ê°œìˆ˜: 9000ê°œ
- ì¶©ëŒ í™•ë¥ : í™œì„± ì„¸ì…˜ < 100ê°œì¼ ë•Œ ~1%

#### 2.2.5 ë¹„í™œì„± ì„¸ì…˜ ì •ë¦¬

```javascript
cleanupInactiveSessions() {
    const now = Date.now();
    const timeout = 30 * 60 * 1000;  // 30ë¶„

    let cleanedCount = 0;

    for (const [sessionId, session] of this.sessions.entries()) {
        const inactiveTime = now - session.lastActivity;

        if (inactiveTime > timeout) {
            // ì„¸ì…˜ ì‚­ì œ
            this.sessions.delete(sessionId);
            this.sessionCodes.delete(session.code);

            // í†µê³„ ì—…ë°ì´íŠ¸
            this.stats.activeSessions--;

            cleanedCount++;

            console.log(`ğŸ—‘ï¸ ì„¸ì…˜ ì •ë¦¬: ${sessionId} (ë¹„í™œì„± ${Math.floor(inactiveTime / 60000)}ë¶„)`);
        }
    }

    if (cleanedCount > 0) {
        console.log(`âœ… ${cleanedCount}ê°œ ì„¸ì…˜ ì •ë¦¬ ì™„ë£Œ`);
    }
}

// ì •ë¦¬ íƒ€ì´ë¨¸ ì‹œì‘
startCleanupTimer() {
    this.cleanupInterval = setInterval(() => {
        this.cleanupInactiveSessions();
    }, 5 * 60 * 1000);  // 5ë¶„ë§ˆë‹¤

    console.log('âœ… ì„¸ì…˜ ì •ë¦¬ íƒ€ì´ë¨¸ ì‹œì‘ (5ë¶„ ê°„ê²©)');
}

// ì •ë¦¬ íƒ€ì´ë¨¸ ì¤‘ì§€
stopCleanupTimer() {
    if (this.cleanupInterval) {
        clearInterval(this.cleanupInterval);
        this.cleanupInterval = null;
        console.log('âœ… ì„¸ì…˜ ì •ë¦¬ íƒ€ì´ë¨¸ ì¤‘ì§€');
    }
}
```

### 2.3 ì—°ê²° í•´ì œ ì²˜ë¦¬

```javascript
handleDisconnect(socketId) {
    // 1. í˜¸ìŠ¤íŠ¸ë¡œ ì—°ê²°ëœ ì„¸ì…˜ ì°¾ê¸°
    for (const [sessionId, session] of this.sessions.entries()) {
        if (session.host === socketId) {
            console.log(`âŒ í˜¸ìŠ¤íŠ¸ ì—°ê²° í•´ì œ: ì„¸ì…˜ ${sessionId} ì¢…ë£Œ`);

            // ì„¸ì…˜ ì‚­ì œ
            this.sessions.delete(sessionId);
            this.sessionCodes.delete(session.code);
            this.stats.activeSessions--;

            return;
        }
    }

    // 2. ì„¼ì„œë¡œ ì—°ê²°ëœ ì„¸ì…˜ ì°¾ê¸°
    for (const [sessionId, session] of this.sessions.entries()) {
        for (const [sensorId, sensor] of session.sensors.entries()) {
            if (sensor.socketId === socketId) {
                console.log(`âŒ ì„¼ì„œ ì—°ê²° í•´ì œ: ${sensorId} (ì„¸ì…˜ ${sessionId})`);

                // ì„¼ì„œ ì‚­ì œ
                session.sensors.delete(sensorId);

                // ì„¼ì„œê°€ ëª¨ë‘ ëŠê¸°ë©´ ì„¸ì…˜ waiting ìƒíƒœë¡œ ì „í™˜
                if (session.sensors.size === 0) {
                    session.status = 'waiting';
                }

                return;
            }
        }
    }
}
```

### 2.4 í†µê³„ ì¡°íšŒ

```javascript
getStats() {
    return {
        totalSessions: this.stats.totalSessions,
        activeSessions: this.stats.activeSessions,
        peakSessions: this.stats.peakSessions,
        totalSensorConnections: this.stats.totalSensorConnections,
        averageSensorsPerSession: this.stats.activeSessions > 0
            ? (this.stats.totalSensorConnections / this.stats.totalSessions).toFixed(2)
            : 0
    };
}
```

---

## 3. GameScanner

### 3.1 í´ë˜ìŠ¤ êµ¬ì¡°

```javascript
// server/GameScanner.js (435ì¤„)
class GameScanner {
    constructor() {
        // ìŠ¤ìº”ëœ ê²Œì„ ëª©ë¡
        this.games = [];

        // Supabase í´ë¼ì´ì–¸íŠ¸
        this.supabase = createClient(
            process.env.SUPABASE_URL,
            process.env.SUPABASE_ANON_KEY
        );

        // ì„¤ì •
        this.config = {
            gamesDir: path.join(__dirname, '../public/games'),
            scanInterval: 5 * 60 * 1000,  // 5ë¶„ë§ˆë‹¤ ìë™ ìŠ¤ìº”
            cacheEnabled: true
        };

        // í†µê³„
        this.stats = {
            totalScans: 0,
            lastScanTime: null,
            lastScanDuration: 0
        };
    }
}
```

### 3.2 ì£¼ìš” ë©”ì„œë“œ

#### 3.2.1 ê²Œì„ ìŠ¤ìº”

```javascript
async scanGames() {
    console.log('ğŸ” ê²Œì„ ìŠ¤ìº” ì‹œì‘...');

    const startTime = Date.now();

    // 1. ë¡œì»¬ ê²Œì„ ìŠ¤ìº”
    const localGames = await this.scanLocalGames();
    console.log(`âœ… ë¡œì»¬ ê²Œì„: ${localGames.length}ê°œ`);

    // 2. ì›ê²© ê²Œì„ ì¡°íšŒ (Supabase)
    const remoteGames = await this.fetchRemoteGames();
    console.log(`âœ… ì›ê²© ê²Œì„: ${remoteGames.length}ê°œ`);

    // 3. ê²Œì„ ë³‘í•© (ì¤‘ë³µ ì œê±°)
    const allGames = this.mergeGames(localGames, remoteGames);
    console.log(`âœ… ì´ ê²Œì„: ${allGames.length}ê°œ`);

    // 4. ê²°ê³¼ ì €ì¥
    this.games = allGames;

    // í†µê³„ ì—…ë°ì´íŠ¸
    this.stats.totalScans++;
    this.stats.lastScanTime = new Date().toISOString();
    this.stats.lastScanDuration = Date.now() - startTime;

    console.log(`âœ… ê²Œì„ ìŠ¤ìº” ì™„ë£Œ (${this.stats.lastScanDuration}ms)`);

    return allGames;
}
```

#### 3.2.2 ë¡œì»¬ ê²Œì„ ìŠ¤ìº”

```javascript
async scanLocalGames() {
    const games = [];
    const gamesDir = this.config.gamesDir;

    // ë””ë ‰í† ë¦¬ ì¡´ì¬ í™•ì¸
    if (!await this.directoryExists(gamesDir)) {
        console.warn(`âš ï¸ ê²Œì„ ë””ë ‰í† ë¦¬ ì—†ìŒ: ${gamesDir}`);
        return games;
    }

    // í•˜ìœ„ ë””ë ‰í† ë¦¬ ì¡°íšŒ
    const folders = await fs.readdir(gamesDir);

    for (const folder of folders) {
        const folderPath = path.join(gamesDir, folder);
        const stat = await fs.stat(folderPath);

        // ë””ë ‰í† ë¦¬ë§Œ ì²˜ë¦¬
        if (!stat.isDirectory()) continue;

        // index.html í™•ì¸
        const indexPath = path.join(folderPath, 'index.html');
        if (!await this.fileExists(indexPath)) {
            console.warn(`âš ï¸ index.html ì—†ìŒ: ${folder}`);
            continue;
        }

        // game.json ë©”íƒ€ë°ì´í„° ë¡œë“œ
        let metadata = await this.loadGameMetadata(folder);

        // metadataê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„±
        if (!metadata) {
            metadata = await this.generateMetadata(folder, indexPath);
        }

        games.push({
            id: folder,
            ...metadata,
            path: `/games/${folder}`,
            indexPath: indexPath,
            source: 'local',
            scannedAt: new Date().toISOString()
        });
    }

    return games;
}
```

#### 3.2.3 ë©”íƒ€ë°ì´í„° ë¡œë“œ

```javascript
async loadGameMetadata(gameId) {
    const metadataPath = path.join(this.config.gamesDir, gameId, 'game.json');

    if (!await this.fileExists(metadataPath)) {
        return null;
    }

    try {
        const content = await fs.readFile(metadataPath, 'utf-8');
        const metadata = JSON.parse(content);

        return metadata;
    } catch (error) {
        console.error(`âŒ ë©”íƒ€ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${gameId}`, error.message);
        return null;
    }
}
```

#### 3.2.4 ìë™ ë©”íƒ€ë°ì´í„° ìƒì„±

```javascript
async generateMetadata(gameId, indexPath) {
    console.log(`ğŸ”§ ìë™ ë©”íƒ€ë°ì´í„° ìƒì„±: ${gameId}`);

    // HTML íŒŒì¼ ì½ê¸°
    const htmlContent = await fs.readFile(indexPath, 'utf-8');

    // ì œëª© ì¶”ì¶œ
    const titleMatch = htmlContent.match(/<title>(.*?)<\/title>/i);
    const title = titleMatch ? titleMatch[1] : gameId;

    // ê²Œì„ íƒ€ì… ì¶”ë¡ 
    let gameType = 'solo';  // ê¸°ë³¸ê°’
    if (htmlContent.includes('gameType: \'dual\'')) gameType = 'dual';
    if (htmlContent.includes('gameType: \'multi\'')) gameType = 'multi';

    // ë©”íƒ€ë°ì´í„° ìƒì„±
    const metadata = {
        title: title,
        description: `${title} - ì„¼ì„œ ê²Œì„`,
        gameType: gameType,
        genre: 'action',  // ê¸°ë³¸ê°’
        version: '1.0',
        author: 'AI Generated',
        createdAt: new Date().toISOString()
    };

    // game.json íŒŒì¼ ìƒì„±
    const metadataPath = path.join(this.config.gamesDir, gameId, 'game.json');
    await fs.writeFile(metadataPath, JSON.stringify(metadata, null, 2), 'utf-8');

    console.log(`âœ… ë©”íƒ€ë°ì´í„° ì €ì¥: ${metadataPath}`);

    return metadata;
}
```

#### 3.2.5 ì›ê²© ê²Œì„ ì¡°íšŒ

```javascript
async fetchRemoteGames() {
    try {
        const { data, error } = await this.supabase
            .from('generated_games')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            throw error;
        }

        return data.map(game => ({
            id: game.game_id,
            title: game.title,
            description: game.description,
            gameType: game.game_type,
            genre: game.genre,
            path: `/games/${game.game_id}`,
            storagePath: game.storage_path,
            playCount: game.play_count,
            creatorId: game.creator_id,
            metadata: game.metadata,
            source: 'remote',
            createdAt: game.created_at
        }));
    } catch (error) {
        console.error('âŒ ì›ê²© ê²Œì„ ì¡°íšŒ ì‹¤íŒ¨:', error.message);
        return [];
    }
}
```

#### 3.2.6 ê²Œì„ ë³‘í•©

```javascript
mergeGames(localGames, remoteGames) {
    const gameMap = new Map();

    // 1. ë¡œì»¬ ê²Œì„ ì¶”ê°€
    for (const game of localGames) {
        gameMap.set(game.id, game);
    }

    // 2. ì›ê²© ê²Œì„ ì¶”ê°€/ë³‘í•©
    for (const game of remoteGames) {
        if (gameMap.has(game.id)) {
            // ë¡œì»¬ê³¼ ì›ê²© ëª¨ë‘ ì¡´ì¬ â†’ ë³‘í•©
            const localGame = gameMap.get(game.id);
            gameMap.set(game.id, {
                ...localGame,
                ...game,
                source: 'both',  // ì–‘ìª½ ëª¨ë‘ ì¡´ì¬
                localPath: localGame.indexPath,
                storagePath: game.storagePath
            });
        } else {
            // ì›ê²©ë§Œ ì¡´ì¬
            gameMap.set(game.id, game);
        }
    }

    // Mapì„ ë°°ì—´ë¡œ ë³€í™˜
    return Array.from(gameMap.values());
}
```

### 3.3 ìë™ ìŠ¤ìº”

```javascript
startAutoScan() {
    this.scanInterval = setInterval(() => {
        console.log('ğŸ”„ ìë™ ìŠ¤ìº” ì‹¤í–‰...');
        this.scanGames();
    }, this.config.scanInterval);

    console.log(`âœ… ìë™ ìŠ¤ìº” ì‹œì‘ (ê°„ê²©: ${this.config.scanInterval / 60000}ë¶„)`);
}

stopAutoScan() {
    if (this.scanInterval) {
        clearInterval(this.scanInterval);
        this.scanInterval = null;
        console.log('âœ… ìë™ ìŠ¤ìº” ì¤‘ì§€');
    }
}
```

---

## 4. GameValidator

### 4.1 ê²€ì¦ ì‹œìŠ¤í…œ êµ¬ì¡°

```javascript
// server/GameValidator.js (972ì¤„)
class GameValidator {
    constructor() {
        // ê²€ì¦ ê·œì¹™
        this.rules = {
            htmlStructure: {
                weight: 20,
                checks: [
                    { name: 'DOCTYPE ì„ ì–¸', pattern: /<!DOCTYPE html>/i, points: 5 },
                    { name: 'HTML íƒœê·¸', pattern: /<html[^>]*>/i, points: 3 },
                    { name: 'Head íƒœê·¸', pattern: /<head>/i, points: 2 },
                    { name: 'Body íƒœê·¸', pattern: /<body>/i, points: 2 },
                    { name: 'Canvas ìš”ì†Œ', pattern: /<canvas/i, points: 5 },
                    { name: 'Script íƒœê·¸', pattern: /<script/i, points: 3 }
                ]
            },
            sessionSDK: {
                weight: 30,
                checks: [
                    { name: 'SessionSDK ì´ˆê¸°í™”', pattern: /new SessionSDK\(/,  points: 8 },
                    { name: 'connected ì´ë²¤íŠ¸', pattern: /sdk\.on\(['"]connected['"]/,  points: 6 },
                    { name: 'createSession í˜¸ì¶œ', pattern: /sdk\.createSession\(/,  points: 6 },
                    { name: 'session-created ì´ë²¤íŠ¸', pattern: /sdk\.on\(['"]session-created['"]/,  points: 4 },
                    { name: 'CustomEvent íŒ¨í„´', pattern: /event\.detail \|\| event/,  points: 3 },
                    { name: 'sessionCode ì†ì„±', pattern: /session\.sessionCode/,  points: 2 },
                    { name: 'sensor-data ì´ë²¤íŠ¸', pattern: /sdk\.on\(['"]sensor-data['"]/,  points: 1 }
                ]
            },
            sensorProcessing: {
                weight: 20,
                checks: [
                    { name: 'orientation ë°ì´í„°', pattern: /orientation\.(alpha|beta|gamma)/,  points: 5 },
                    { name: 'acceleration ë°ì´í„°', pattern: /acceleration\.[xyz]/,  points: 3 },
                    { name: 'ì •ê·œí™” ì²˜ë¦¬', pattern: /\/\s*(90|180)/,  points: 5 },
                    { name: 'processSensorData í•¨ìˆ˜', pattern: /function\s+processSensorData/,  points: 4 },
                    { name: 'null ì²´í¬', pattern: /if\s*\(\s*!.*data/,  points: 3 }
                ]
            },
            gameLogic: {
                weight: 15,
                checks: [
                    { name: 'gameLoop í•¨ìˆ˜', pattern: /function\s+gameLoop/,  points: 4 },
                    { name: 'requestAnimationFrame', pattern: /requestAnimationFrame/,  points: 4 },
                    { name: 'gameState ê´€ë¦¬', pattern: /gameState|status/,  points: 3 },
                    { name: 'ì ìˆ˜ ì‹œìŠ¤í…œ', pattern: /score/i,  points: 2 },
                    { name: 'ì¶©ëŒ ê²€ì‚¬', pattern: /collision|intersect/i,  points: 2 }
                ]
            },
            uiUX: {
                weight: 15,
                checks: [
                    { name: 'QR ì½”ë“œ ìƒì„±', pattern: /qrcode|QRCode/i,  points: 4 },
                    { name: 'ì„¸ì…˜ ì½”ë“œ í‘œì‹œ', pattern: /session-code|sessionCode/,  points: 3 },
                    { name: 'Canvas ë Œë”ë§', pattern: /ctx\.(fill|stroke|draw)/,  points: 3 },
                    { name: 'clearRect ì‚¬ìš©', pattern: /clearRect/,  points: 2 },
                    { name: 'ìŠ¤íƒ€ì¼ ì •ì˜', pattern: /<style>/i,  points: 3 }
                ]
            }
        };
    }
}
```

### 4.2 ê²€ì¦ ì‹¤í–‰

```javascript
async validateGameCode(htmlCode, requirements) {
    const results = {
        score: 0,
        maxScore: 100,
        passed: false,
        errors: [],
        warnings: [],
        details: {}
    };

    // 1. HTML êµ¬ì¡° ê²€ì¦ (20ì )
    results.details.structure = this.validateHTMLStructure(htmlCode);
    results.score += results.details.structure.score;

    // 2. SessionSDK í†µí•© ê²€ì¦ (30ì )
    results.details.sdk = this.validateSessionSDKIntegration(htmlCode);
    results.score += results.details.sdk.score;

    // 3. ì„¼ì„œ ì²˜ë¦¬ ë¡œì§ ê²€ì¦ (20ì )
    results.details.sensor = this.validateSensorProcessing(htmlCode, requirements.gameType);
    results.score += results.details.sensor.score;

    // 4. ê²Œì„ ë¡œì§ ê²€ì¦ (15ì )
    results.details.gameLogic = this.validateGameLogic(htmlCode, requirements.genre);
    results.score += results.details.gameLogic.score;

    // 5. UI/UX ê²€ì¦ (15ì )
    results.details.ui = this.validateUIElements(htmlCode);
    results.score += results.details.ui.score;

    // ì¢…í•© íŒì •
    results.passed = results.score >= 95;

    if (!results.passed) {
        results.errors.push(`í’ˆì§ˆ ë¯¸ë‹¬: ${results.score}ì  (ìµœì†Œ: 95ì )`);
    }

    return results;
}
```

### 4.3 SessionSDK í†µí•© ê²€ì¦

```javascript
validateSessionSDKIntegration(htmlCode) {
    const checks = this.rules.sessionSDK.checks;
    const maxScore = this.rules.sessionSDK.weight;

    let score = 0;
    const passed = [];
    const failed = [];

    for (const check of checks) {
        if (check.pattern.test(htmlCode)) {
            score += check.points;
            passed.push(check.name);
        } else {
            failed.push(check.name);
        }
    }

    // ê²½ê³  ìƒì„±
    const warnings = [];
    if (failed.includes('CustomEvent íŒ¨í„´')) {
        warnings.push('CustomEvent íŒ¨í„´ (event.detail || event) ì‚¬ìš© ê¶Œì¥');
    }
    if (failed.includes('sessionCode ì†ì„±')) {
        warnings.push('session.sessionCode ì‚¬ìš© (session.code ì•„ë‹˜!)');
    }

    return {
        score: Math.min(score, maxScore),
        maxScore: maxScore,
        passed: passed,
        failed: failed,
        warnings: warnings
    };
}
```

---

## 5. SessionSDK

### 5.1 í´ë˜ìŠ¤ êµ¬ì¡°

```javascript
// public/js/SessionSDK.js (590ì¤„)
class SessionSDK extends EventTarget {
    constructor(options) {
        super();

        this.config = {
            serverUrl: options.serverUrl || window.location.origin,
            gameId: options.gameId,
            gameType: options.gameType,
            autoReconnect: options.autoReconnect !== false,
            debug: options.debug || false
        };

        this.state = {
            connected: false,
            session: null,
            reconnectAttempts: 0,
            maxReconnectAttempts: 5
        };

        this.socket = null;

        // ìë™ ì—°ê²°
        this.connect();
    }
}
```

### 5.2 ì—°ê²° ê´€ë¦¬

```javascript
async connect() {
    if (this.config.debug) {
        console.log('ğŸ”Œ ì„œë²„ ì—°ê²° ì‹œë„:', this.config.serverUrl);
    }

    // Socket.IO ì—°ê²°
    this.socket = io(this.config.serverUrl, {
        transports: ['websocket', 'polling'],
        reconnection: this.config.autoReconnect,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 5000,
        reconnectionAttempts: this.state.maxReconnectAttempts
    });

    this.setupSocketEvents();

    // ì—°ê²° ëŒ€ê¸°
    await this.waitForConnection();
}

setupSocketEvents() {
    // ì—°ê²° ì„±ê³µ
    this.socket.on('connect', () => {
        this.state.connected = true;
        this.state.reconnectAttempts = 0;

        if (this.config.debug) {
            console.log('âœ… ì„œë²„ ì—°ê²° ì„±ê³µ');
        }

        this.emit('connected');
    });

    // ì—°ê²° í•´ì œ
    this.socket.on('disconnect', (reason) => {
        this.state.connected = false;

        if (this.config.debug) {
            console.log('âŒ ì„œë²„ ì—°ê²° í•´ì œ:', reason);
        }

        this.emit('disconnected', { reason });
    });

    // ì¬ì—°ê²° ì‹œë„
    this.socket.on('reconnect_attempt', (attemptNumber) => {
        this.state.reconnectAttempts = attemptNumber;

        if (this.config.debug) {
            console.log(`ğŸ”„ ì¬ì—°ê²° ì‹œë„ ${attemptNumber}/${this.state.maxReconnectAttempts}`);
        }
    });

    // ì¬ì—°ê²° ì„±ê³µ
    this.socket.on('reconnect', (attemptNumber) => {
        if (this.config.debug) {
            console.log(`âœ… ì¬ì—°ê²° ì„±ê³µ (${attemptNumber}íšŒ ì‹œë„)`);
        }

        this.emit('reconnected', { attempts: attemptNumber });
    });

    // ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸
    this.socket.on('session-created', (data) => {
        this.state.session = data;
        this.emit('session-created', data);
    });

    this.socket.on('sensor-connected', (data) => {
        this.emit('sensor-connected', data);
    });

    this.socket.on('sensor-update', (data) => {
        this.emit('sensor-data', data);
    });

    this.socket.on('game-ready', (data) => {
        this.emit('game-ready', data);
    });

    this.socket.on('error', (data) => {
        this.emit('error', data);
    });
}
```

### 5.3 ì„¸ì…˜ ìƒì„±

```javascript
async createSession() {
    if (!this.state.connected) {
        throw new Error('ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    }

    return new Promise((resolve, reject) => {
        const timeout = setTimeout(() => {
            reject(new Error('ì„¸ì…˜ ìƒì„± íƒ€ì„ì•„ì›ƒ (10ì´ˆ)'));
        }, 10000);

        this.socket.once('session-created', (data) => {
            clearTimeout(timeout);
            this.state.session = data;
            resolve(data);
        });

        this.socket.emit('create-session', {
            gameId: this.config.gameId,
            gameType: this.config.gameType
        });
    });
}
```

### 5.4 CustomEvent ë°œí–‰

```javascript
emit(eventName, data) {
    const event = new CustomEvent(eventName, {
        detail: data,
        bubbles: true,
        cancelable: true
    });

    this.dispatchEvent(event);

    if (this.config.debug) {
        console.log(`ğŸ“¢ ì´ë²¤íŠ¸ ë°œí–‰: ${eventName}`, data);
    }
}
```

---

## 6. ëª¨ë“ˆ ê°„ ìƒí˜¸ì‘ìš©

### 6.1 ê²Œì„ ìƒì„± íë¦„

```
ì‚¬ìš©ì ìš”ì²­
    â†“
InteractiveGameGenerator
    â”œâ”€â†’ GameGenreClassifier (ì¥ë¥´ ë¶„ë¥˜)
    â”œâ”€â†’ DocumentEmbedder (RAG ê²€ìƒ‰)
    â”œâ”€â†’ Claude API (ì½”ë“œ ìƒì„±)
    â””â”€â†’ GameValidator (ê²€ì¦)
            â†“
        íŒŒì¼ ì €ì¥
            â†“
        GameScanner (ì¬ìŠ¤ìº”)
            â†“
        ê²Œì„ ëª©ë¡ ì—…ë°ì´íŠ¸
```

### 6.2 ê²Œì„ í”Œë ˆì´ íë¦„

```
PC: SessionSDK.createSession()
    â†“
ì„œë²„: SessionManager.createSession()
    â†“
PC: QR ì½”ë“œ í‘œì‹œ
    â†“
ëª¨ë°”ì¼: QR ìŠ¤ìº” â†’ sensor.html
    â†“
ëª¨ë°”ì¼: SensorCollector.start()
    â†“
ëª¨ë°”ì¼: socket.emit('connect-sensor')
    â†“
ì„œë²„: SessionManager.connectSensor()
    â†“
ì„œë²„: socket.emit('sensor-connected') â†’ PC
    â†“
PC: ê²Œì„ ì‹œì‘
    â†“
ëª¨ë°”ì¼: socket.emit('sensor-data') (50ms ê°„ê²©)
    â†“
ì„œë²„: SessionManager ë¼ìš°íŒ… â†’ PC
    â†“
PC: processSensorData() â†’ ê²Œì„ ì—…ë°ì´íŠ¸
```

---

**ë¬¸ì„œ ë**

ë‹¤ìŒ ë¬¸ì„œ: [06_ì‹œìŠ¤í…œ_í”Œë¡œìš°.md](./06_ì‹œìŠ¤í…œ_í”Œë¡œìš°.md)
